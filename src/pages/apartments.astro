---
import BaseLayout from '../layouts/BaseLayout.astro'

const placeholder =
  'data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw=='

const pageTitle = 'Apartments â€” CristallPont Amalfi Day'
const pageDescription =
  'Apartments, suites, and rooms in Atrani near Amalfi beach. Browse stays, galleries, and availability for Amalfi Coast trips.'
const shareImage = '/apartments/3-view-from-cristall-Pont.jpg'

const stats = [
  { value: '15+', label: 'Years of experience' },
  { value: '1000+', label: 'Positive Airbnb and Booking reviews' },
]

const staySections = [
  {
    title: 'Timeless Retreat in Ravello',
    subtitle: 'Historical 2-bedroom apartment',
    columns: 1,
    stays: [
      {
        name: 'Villa Susy',
        description:
          "This villa, located just a mile from Amalfi, offers a unique blend of authenticity and comfort. As you step inside, you'll be transported to a world where the past comes alive, and the present moment is savored.",
        gallery: [5124, 5123, 5121, 5122],
        calendar: 'Villa Susy',
        galleryStyle: 'scroll',
      },
    ],
  },
  {
    title: 'Suites by the sea',
    subtitle: 'Apartment options that keep you close to the beach and the Atrani rhythm.',
    columns: 2,
    stays: [
      {
        name: 'Awesome apartments',
        description:
          'Our location is just above the city center, a 5-7 minute walk uphill via 350 steps. The apartment features a separate kitchen, shower room, and a spacious room.',
        gallery: [2076],
        calendar: 'Awesome Apts',
      },
      {
        name: 'Aria di Mare',
        description:
          'This newly decorated apartment is located in the very center of Atrani, close to the main street. It features a small balcony with a beautiful mountain-views.',
        gallery: [5114, 5115],
        calendar: null,
      },
      {
        name: 'Suite Carina',
        description:
          'This is a double-level apartment located in the heart of the city. There are no steps to access the apartment. The windows offer views of the main street in Atrani.',
        gallery: [2258, 2257, 2256],
        calendar: 'Casa Carina',
      },
      {
        name: 'Suite Harmony',
        description:
          'This newly decorated apartment is located in the very center of Atrani, close to the main street. It features a small balcony with a beautiful mountain-views.',
        gallery: [2464, 2422, 2461],
        calendar: 'Harmony Suite',
      },
    ],
  },
  {
    title: 'Rooms in our townhouse',
    subtitle: 'Design-led rooms with balconies and vintage details in the heart of Atrani.',
    columns: 2,
    stays: [
      {
        name: 'Vintage interior',
        description:
          'The room is designed with a vintage aesthetic in mind, featuring decor and furnishings that evoke a sense of nostalgia and timeless elegance. The room also comes equipped with a large closet, complete with a mirror, providing ample storage and a convenient space for getting ready. Additionally, the room has a balcony, which allows guests to enjoy fresh air and a view while relaxing in the comfort of their own space.',
        gallery: [5203],
        calendar: 'Vintage Room',
      },
      {
        name: 'Orange room',
        description:
          'This room evokes the nostalgia of the 1960s with its decor and furnishings. The room features a large multi-panel closet, providing ample storage space for guests. The room also comes with with couple of garden chairs and a table. Additionally, the room has a balcony, which allows guests to enjoy fresh air and a view while relaxing in the comfort of their own space.',
        gallery: [2251],
        calendar: 'Orange Room',
      },
      {
        name: 'Room in center',
        description:
          'This is the largest room in the house, providing plenty of space for guests to spread out and relax. The room features a large table, perfect for meals or working, and two chairs for comfortable seating. Additionally, the room has a small balcony that offers a view of the main street, perfect for enjoying the sights and sounds of the city. The closet is an original piece from the 1970s that is spacious and adds a vintage touch to the room.',
        gallery: [5202],
        calendar: 'Central Room',
      },
    ],
  },
  {
    title: 'Cost-effective stays',
    subtitle: 'Smart, comfortable rooms for short stays and solo adventures.',
    columns: 2,
    stays: [
      {
        name: 'Room for solo traveller',
        description:
          'This room is designed to be cozy and comfortable, with a small bed that is perfect for one person. The room features a spacious balcony that offers a great place to sit and relax, with a chair that provides a comfortable seating option. The balcony also offers a beautiful view of the mountains, providing a serene and peaceful atmosphere. Additionally, the room is facing the main street of the town, which means that guests can enjoy the hustle and bustle of the city right from the comfort of their own room. The balcony can be accessed via the room and it is perfect for a morning coffee or a nightcap.',
        gallery: [2285],
        calendar: 'Solo Room',
      },
      {
        name: 'Room for youngsters',
        description:
          'This room is designed to be functional and budget-friendly, perfect for travelers who are looking for a comfortable and affordable place to stay. The room features a bunk bed. The bunk bed is comfortable and convenient, providing a great place to rest after a long day of exploring. The room also features a big mural on the wall, which adds a unique and artistic touch to the space, making it more interesting and personalized. The room also comes with a large window that overlooks an inner street, providing natural light. The window can be opened to let fresh air in and to listen to the street sounds.',
        gallery: [2262],
        calendar: 'Bunkbed Room',
      },
    ],
  },
]

const testimonials = [
  {
    quote:
      "My stay in Atrani was wonderful! Very close to Amalfi, it's a short distance walking and you get to enjoy the view and the way there Gregory is a very nice host, He answered all my questions, I got to know his family wish they were nice to me as well , I recommend this beautiful place 100% It's worth it!",
    author: 'Silvia, Howey-in-the-Hills, FL',
    meta: 'December 2022',
  },
  {
    quote:
      'Amazing stay and location, 10 minute walk to edge of Amalfi. Everything was clean and tidy, kitchen was great and well-stocked. And host is super friendly and interesting. Even more, the host has a great website guiding us on how to get there and the attractions in Amalfi. I would recommend to everybody who wants to come here.',
    author: 'Ethan, London, United Kingdom',
    meta: 'October 2022',
  },
  {
    quote:
      'Perfect for what I needed and looked exactly like the pictures. Communication with Gregory was great and he messaged back immediately when I was having trouble finding the walking route from Amalfi to Atrani. He provided a great guide of suggestions of things to do. I was able to easily do day trips to Ravello, a Positano boat tour and walk to Amalfi.',
    author: 'Erin, Brighton East, Australia',
    meta: 'October 2022',
  },
  {
    quote:
      "Amazing stay. Wifi was great. Room was cozy and clean. Loved the balcony. Shared restroom was also clean and had supplies like soap,detergent,etc. Honestly I wish I went to Gregory's airbnb as soon as I got to Amalfi coast it's a great location you'll be right next to Amalfi only like a 10 minute walk it's great you got the beach next to you!",
    author: 'Sofia, Paris, France',
    meta: 'October 2022',
  },
]
---

<BaseLayout title={pageTitle} description={pageDescription} image={shareImage}>
  <section class="section apartments-hero">
    <div class="container apartments-hero__grid">
      <div class="apartments-hero__copy">
        <span class="eyebrow">Comfortable stays</span>
        <h1>
          <span class="accent-italic">Apartments</span>, rooms, and
          <span class="accent-italic">villa</span> near
          <span class="accent-italic">Atrani</span>
        </h1>
        <p class="lead">
          Most of our apartments are located in the center of Atrani, just a 2-minute walk from
          the main square and Atrani's beach.
        </p>
        <div class="apartments-hero__stats">
          {stats.map((item) => (
            <div class="stat">
              <strong>{item.value}</strong>
              <span>{item.label}</span>
            </div>
          ))}
        </div>
      </div>
      <div class="apartments-hero__visual">
        <div class="image-stack">
          <figure class="image-frame image-frame--tall image-frame--hero">
            <img
              src="/apartments/3-view-from-cristall-Pont.jpg"
              alt="View over Atrani rooftops"
              loading="lazy"
              decoding="async"
            />
          </figure>
          <figure class="image-frame image-frame--wide">
            <img
              src={placeholder}
              data-wp-id="2285"
              alt="Cozy apartment interior"
              loading="lazy"
              decoding="async"
            />
          </figure>
        </div>
      </div>
    </div>
  </section>

  {staySections.map((section) => (
    <section
      class={`section stay-section${section.columns === 2 ? ' stay-section--two' : ''}`}
    >
      <div class="container section__header">
        <h2>{section.title}</h2>
        {section.subtitle && <p>{section.subtitle}</p>}
      </div>
      <div class="container stay-grid">
        {section.stays.map((stay) => (
          <article
            class={`stay-card${stay.galleryStyle === 'scroll' ? ' stay-card--scroll stay-card--villa' : ''}`}
          >
            <div
              class={`stay-card__media${stay.galleryStyle === 'scroll' ? ' stay-card__media--scroll' : ''}`}
              data-gallery
              data-gallery-mode={stay.galleryStyle ?? 'cycle'}
            >
              {stay.galleryStyle === 'scroll' ? (
                <>
                  <div class="stay-card__track">
                  {stay.gallery.map((imageId) => (
                    <div class="stay-card__slide">
                      <img
                        class="stay-card__slide-image"
                        src={placeholder}
                        data-wp-id={String(imageId)}
                        alt={`${stay.name} photo`}
                        loading="lazy"
                        decoding="async"
                      />
                    </div>
                  ))}
                  </div>
                  <button
                    class="gallery-control gallery-control--scroll"
                    type="button"
                    data-gallery-prev
                    aria-label="Previous photo"
                  >
                    <i class="bi bi-chevron-left"></i>
                  </button>
                  <button
                    class="gallery-control gallery-control--scroll"
                    type="button"
                    data-gallery-next
                    aria-label="Next photo"
                  >
                    <i class="bi bi-chevron-right"></i>
                  </button>
                </>
              ) : (
                <>
                  {stay.gallery.map((imageId, index) => (
                    <img
                      class={`stay-card__image${index === 0 ? ' is-active' : ''}`}
                      src={placeholder}
                      data-wp-id={String(imageId)}
                      data-gallery-image
                      alt={`${stay.name} photo`}
                      loading="lazy"
                      decoding="async"
                    />
                  ))}
                  {stay.gallery.length > 1 && (
                    <>
                      <button
                        class="gallery-control"
                        type="button"
                        data-gallery-prev
                        aria-label="Previous photo"
                      >
                        <i class="bi bi-chevron-left"></i>
                      </button>
                      <button
                        class="gallery-control"
                        type="button"
                        data-gallery-next
                        aria-label="Next photo"
                      >
                        <i class="bi bi-chevron-right"></i>
                      </button>
                    </>
                  )}
                </>
              )}
            </div>

            {stay.galleryStyle === 'scroll' ? (
              <div class="stay-card__details">
                <div class="stay-card__content">
                  <h3>{stay.name}</h3>
                  <p>{stay.description}</p>
                </div>
                <div
                  class="stay-calendar"
                  data-calendar
                  data-calendar-name={stay.calendar ?? ''}
                >
                  <span class="calendar__loading">Loading availability...</span>
                </div>
              </div>
            ) : (
              <div class="stay-card__content">
                <h3>{stay.name}</h3>
                <p>{stay.description}</p>
                <div
                  class="stay-calendar"
                  data-calendar
                  data-calendar-name={stay.calendar ?? ''}
                >
                  <span class="calendar__loading">Loading availability...</span>
                </div>
              </div>
            )}
          </article>
        ))}
      </div>
    </section>
  ))}

  <section class="section section--adventure">
    <div class="container adventure-grid">
      <div class="adventure-copy">
        <span class="eyebrow">amalfi.day</span>
        <h2>Adventure awaits</h2>
        <p class="lead">
          We offer comfortable and cost-effective stays in apartments, rooms, and a villa near
          Atrani. Most of their apartments are located in the center of Atrani, just a 2-minute
          walk from the main square and Atrani's beach. With 15+ years of experience and 1000+
          five star Airbnb reviews, they are a trusted and reliable choice for travelers.
        </p>
        <div class="adventure-pillars">
          <div class="pillar">
            <h3>Comfortable</h3>
            <p>
              As we understand the needs of travelers visiting Amalfi, we have designed our
              rooms and apartments to be comfortable for short-term stays.
            </p>
          </div>
          <div class="pillar">
            <h3>...and cost-effective</h3>
            <p>
              We understand that budget can be a concern for travelers, so we have several
              cost-effective options that will ensure your holiday in Amalfi is enjoyable and
              fantastic.
            </p>
          </div>
        </div>
      </div>
      <div class="adventure-media">
        <img
          src={placeholder}
          data-wp-id="3898"
          alt="Atrani townscape at sunset"
          loading="lazy"
          decoding="async"
        />
      </div>
    </div>
  </section>

  <section class="section testimonials">
    <div class="container section__header">
      <h2>Guest impressions</h2>
      <p>Recent words from travelers who stayed with us in Atrani.</p>
    </div>
    <div class="container testimonials__grid">
      {testimonials.map((item) => (
        <article class="testimonial">
          <p>"{item.quote}"</p>
          <div class="testimonial__meta">
            <strong>{item.author}</strong>
            <span>{item.meta}</span>
          </div>
        </article>
      ))}
    </div>
  </section>
</BaseLayout>

<script is:inline>
  ;(() => {
    const images = Array.from(document.querySelectorAll('img[data-wp-id]'))
    if (!images.length) return

    const ids = [...new Set(images.map((img) => img.dataset.wpId).filter(Boolean))]
    const apiBase = 'https://amalfi.day/wp-json/wp/v2/media/'
    const cache = new Map()

    const fetchMedia = async (id) => {
      if (cache.has(id)) return cache.get(id)
      try {
        const res = await fetch(`${apiBase}${id}`)
        if (!res.ok) throw new Error(`media ${id} not found`)
        const data = await res.json()
        const media = { url: data.source_url, alt: data.alt_text }
        cache.set(id, media)
        return media
      } catch (error) {
        console.warn(error)
        cache.set(id, null)
        return null
      }
    }

    ids.forEach(async (id) => {
      const media = await fetchMedia(id)
      if (!media) return
      images
        .filter((img) => img.dataset.wpId === id)
        .forEach((img) => {
          img.src = media.url
          if (!img.alt && media.alt) {
            img.alt = media.alt
          }
        })
    })
  })()
</script>

<script is:inline>
  ;(() => {
    const galleries = Array.from(document.querySelectorAll('[data-gallery]'))

    galleries.forEach((gallery) => {
      const mode = gallery.dataset.galleryMode || 'cycle'
      if (mode === 'scroll') {
        const track = gallery.querySelector('.stay-card__track')
        const slides = track ? Array.from(track.querySelectorAll('.stay-card__slide')) : []
        const prevBtn = gallery.querySelector('[data-gallery-prev]')
        const nextBtn = gallery.querySelector('[data-gallery-next]')

        const getClosestIndex = () => {
          if (!track || !slides.length) return 0
          const center = track.scrollLeft + track.clientWidth / 2
          let closestIndex = 0
          let closestDistance = Infinity
          slides.forEach((slide, index) => {
            const slideCenter = slide.offsetLeft + slide.offsetWidth / 2
            const distance = Math.abs(slideCenter - center)
            if (distance < closestDistance) {
              closestDistance = distance
              closestIndex = index
            }
          })
          return closestIndex
        }

        const scrollToIndex = (index) => {
          if (!track || !slides.length) return
          const clamped = Math.max(0, Math.min(index, slides.length - 1))
          const slide = slides[clamped]
          const left = slide.offsetLeft + slide.offsetWidth / 2 - track.clientWidth / 2
          track.scrollTo({ left, behavior: 'smooth' })
        }

        nextBtn?.addEventListener('click', () => {
          const current = getClosestIndex()
          scrollToIndex(current + 1)
        })

        prevBtn?.addEventListener('click', () => {
          const current = getClosestIndex()
          scrollToIndex(current - 1)
        })

        return
      }
      const images = Array.from(gallery.querySelectorAll('[data-gallery-image]'))
      if (images.length <= 1) return

      let index = 0
      const show = (nextIndex) => {
        index = (nextIndex + images.length) % images.length
        images.forEach((img, i) => {
          img.classList.toggle('is-active', i === index)
        })
      }

      const next = () => show(index + 1)
      const prev = () => show(index - 1)

      gallery.addEventListener('click', (event) => {
        const target = event.target.closest('button[data-gallery-next], button[data-gallery-prev]')
        if (target?.hasAttribute('data-gallery-next')) {
          next()
          return
        }
        if (target?.hasAttribute('data-gallery-prev')) {
          prev()
          return
        }
        if (event.target.closest('img[data-gallery-image]')) {
          next()
        }
      })

      let startX = 0
      gallery.addEventListener('touchstart', (event) => {
        startX = event.touches[0]?.clientX ?? 0
      })
      gallery.addEventListener('touchend', (event) => {
        const endX = event.changedTouches[0]?.clientX ?? 0
        const diff = endX - startX
        if (Math.abs(diff) < 35) return
        if (diff < 0) {
          next()
        } else {
          prev()
        }
      })
    })
  })()
</script>

<script is:inline>
  ;(() => {
    const calendars = Array.from(document.querySelectorAll('[data-calendar]'))
    if (!calendars.length) return

    const monthNames = [
      'January',
      'February',
      'March',
      'April',
      'May',
      'June',
      'July',
      'August',
      'September',
      'October',
      'November',
      'December',
    ]
    const dayLabels = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun']

    const formatDate = (date) => {
      const year = date.getFullYear()
      const month = `${date.getMonth() + 1}`.padStart(2, '0')
      const day = `${date.getDate()}`.padStart(2, '0')
      return `${year}-${month}-${day}`
    }

    const renderMonth = (year, month, busy, today) => {
      const firstDay = new Date(year, month, 1)
      const offset = (firstDay.getDay() + 6) % 7
      const daysInMonth = new Date(year, month + 1, 0).getDate()
      const cells = []

      for (let i = 0; i < offset; i += 1) {
        cells.push('<span class="calendar__cell is-empty"></span>')
      }

      for (let day = 1; day <= daysInMonth; day += 1) {
        const date = new Date(year, month, day)
        const key = formatDate(date)
        const isBusy = busy.has(key)
        const isPast = date < today
        const classes = [
          'calendar__cell',
          isBusy ? 'is-busy' : 'is-free',
          isPast ? 'is-past' : '',
        ]
          .filter(Boolean)
          .join(' ')
        cells.push(`<span class="${classes}">${day}</span>`)
      }

      return `
        <div class="calendar__month">
          <div class="calendar__month-title">${monthNames[month]} ${year}</div>
          <div class="calendar__grid">
            ${dayLabels.map((label) => `<span class="calendar__dow">${label}</span>`).join('')}
            ${cells.join('')}
          </div>
        </div>
      `
    }

    const renderCalendar = (el, busy) => {
      const today = new Date()
      const current = new Date(today.getFullYear(), today.getMonth(), 1)
      const next = new Date(today.getFullYear(), today.getMonth() + 1, 1)

      el.innerHTML = `
        <div class="calendar">
          ${renderMonth(current.getFullYear(), current.getMonth(), busy, today)}
          ${renderMonth(next.getFullYear(), next.getMonth(), busy, today)}
        </div>
        <div class="calendar__legend">
          <span><i class="legend legend--free"></i> Available</span>
          <span><i class="legend legend--busy"></i> Booked</span>
        </div>
      `
    }

    const availabilityPromise = fetch('/calendars/availability.json', { cache: 'no-store' })
      .then((res) => (res.ok ? res.json() : null))
      .catch(() => null)

    calendars.forEach(async (calendarEl) => {
      const calendarName = calendarEl.dataset.calendarName
      if (!calendarName) {
        calendarEl.innerHTML = '<span class="calendar__empty">Calendar coming soon.</span>'
        return
      }

      const availability = await availabilityPromise
      if (!availability?.calendars) {
        calendarEl.innerHTML = '<span class="calendar__empty">Calendar updating...</span>'
        return
      }

      if (!(calendarName in availability.calendars)) {
        calendarEl.innerHTML = '<span class="calendar__empty">Calendar coming soon.</span>'
        return
      }

      const busyList = availability.calendars[calendarName] || []
      const busy = new Set(busyList)
      renderCalendar(calendarEl, busy)
    })
  })()
</script>

<style>
  .apartments-hero {
    position: relative;
    padding-top: 5rem;
    background: linear-gradient(120deg, rgba(255, 89, 0, 0.08), rgba(0, 156, 255, 0.08));
  }

  .apartments-hero__grid {
    display: grid;
    gap: 3rem;
    grid-template-columns: repeat(2, minmax(0, 1fr));
    align-items: center;
  }

  .apartments-hero__copy h1 {
    font-size: clamp(2.5rem, 4vw, 3.6rem);
    margin-bottom: 1rem;
  }

  .lead {
    font-size: 1.1rem;
  }

  .eyebrow {
    display: inline-block;
    font-size: 0.85rem;
    letter-spacing: 0.2em;
    text-transform: uppercase;
    color: var(--color-accent);
    margin-bottom: 0.8rem;
  }

  .apartments-hero__stats {
    display: flex;
    flex-wrap: wrap;
    gap: 1.5rem;
    margin-top: 2rem;
  }

  .stat {
    min-width: 160px;
    padding: 1rem 1.4rem;
    border-radius: 16px;
    background: var(--color-card);
    border: 1px solid var(--color-border);
    box-shadow: var(--shadow-soft);
  }

  .stat strong {
    font-size: 1.6rem;
    display: block;
    color: var(--color-text);
  }

  .stat span {
    font-size: 0.95rem;
    color: var(--color-text-muted);
  }

  .apartments-hero__visual {
    display: flex;
    justify-content: center;
  }

  .image-stack {
    position: relative;
    width: min(460px, 100%);
    height: 520px;
  }

  .image-frame {
    overflow: hidden;
    border-radius: 22px;
    box-shadow: var(--shadow-lift);
    border: 1px solid rgba(255, 255, 255, 0.6);
    background: var(--color-surface);
  }

  .image-frame img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .image-frame--tall {
    position: absolute;
    inset: 0 auto auto 0;
    width: 70%;
    height: 100%;
  }

  .image-frame--hero {
    border-radius: 0;
    box-shadow: none;
    border: none;
    background: transparent;
    top: calc(-1 * (5rem + var(--header-space)));
    height: calc(100% + 5rem + var(--header-space));
  }

  .image-frame--hero img {
    border-radius: 0;
  }

  .image-frame--wide {
    position: absolute;
    bottom: -4%;
    right: 0;
    width: 58%;
    height: 45%;
    border: 8px solid var(--color-bg);
  }

  .stay-section {
    padding-top: 3rem;
  }

  .section__header {
    display: flex;
    flex-direction: column;
    gap: 0.4rem;
    margin-bottom: 2rem;
  }

  .stay-section .section__header h2 {
    font-size: clamp(2.4rem, 3.6vw, 3.6rem);
  }

  .stay-grid {
    display: grid;
    gap: 2.5rem;
  }

  .stay-section--two .stay-grid {
    grid-template-columns: repeat(2, minmax(0, 1fr));
    align-items: start;
  }

  .stay-card {
    display: grid;
    gap: 1.5rem;
    grid-template-columns: 1fr;
    padding: 0;
    border: none;
    background: transparent;
    box-shadow: none;
  }

  .stay-card__media {
    position: relative;
    border-radius: 22px;
    overflow: hidden;
    background: var(--color-surface);
    aspect-ratio: 4 / 3;
    cursor: pointer;
  }

  .stay-card__media--scroll {
    aspect-ratio: auto;
    cursor: grab;
    mask-image: linear-gradient(90deg, transparent 0%, #000 8%, #000 92%, transparent 100%);
    -webkit-mask-image: linear-gradient(
      90deg,
      transparent 0%,
      #000 8%,
      #000 92%,
      transparent 100%
    );
    width: 100%;
    margin: 0;
  }

  .stay-card__image {
    width: 100%;
    height: 100%;
    position: absolute;
    inset: 0;
    object-fit: cover;
    opacity: 0;
    transition: opacity 0.3s ease;
  }

  .stay-card__image.is-active {
    opacity: 1;
  }

  .stay-card__track {
    display: flex;
    gap: 1rem;
    padding: 0 0.5rem 0.5rem;
    overflow-x: auto;
    scroll-snap-type: x mandatory;
    scrollbar-width: none;
  }

  .stay-card__track::-webkit-scrollbar {
    display: none;
  }

  .stay-card__slide {
    flex: 0 0 72%;
    scroll-snap-align: center;
  }

  .stay-card__slide-image {
    width: 100%;
    height: clamp(200px, 24vw, 280px);
    border-radius: 18px;
    object-fit: cover;
  }

  .stay-card--scroll .stay-card__media {
    background: transparent;
  }

  .gallery-control--scroll {
    top: 50%;
    transform: translateY(-50%);
    background: rgba(255, 255, 255, 0.9);
  }

  .stay-card__media--scroll .gallery-control--scroll {
    position: absolute;
  }

  .stay-card__media--scroll .gallery-control--scroll[data-gallery-prev] {
    left: 8px;
  }

  .stay-card__media--scroll .gallery-control--scroll[data-gallery-next] {
    right: 8px;
  }

  .stay-card--villa .stay-card__details {
    display: grid;
    gap: 2rem;
    grid-template-columns: minmax(0, 1fr) minmax(0, 0.9fr);
    align-items: start;
  }

  .stay-card--villa .stay-card__content {
    max-width: 520px;
  }

  .stay-card--villa .stay-calendar {
    margin-top: 0;
  }

  .gallery-control {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    width: 42px;
    height: 42px;
    border-radius: 50%;
    border: none;
    background: rgba(255, 255, 255, 0.85);
    color: var(--color-text);
    display: inline-flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    box-shadow: var(--shadow-soft);
  }

  .gallery-control[data-gallery-prev] {
    left: 16px;
  }

  .gallery-control[data-gallery-next] {
    right: 16px;
  }

  .stay-card__content h3 {
    margin-bottom: 0.6rem;
  }

  .section--adventure {
    background: var(--color-surface);
  }

  .adventure-grid {
    display: grid;
    gap: 2.5rem;
    grid-template-columns: minmax(0, 1.1fr) minmax(0, 0.9fr);
    align-items: center;
  }

  .adventure-media img {
    width: 100%;
    border-radius: var(--radius-lg);
    aspect-ratio: 3 / 4;
    object-fit: cover;
  }

  .adventure-pillars {
    display: grid;
    gap: 1.5rem;
    grid-template-columns: repeat(2, minmax(0, 1fr));
    margin-top: 2rem;
  }

  .pillar {
    padding: 1.1rem 0;
    border-bottom: 1px solid var(--color-border);
  }

  .testimonials__grid {
    display: grid;
    gap: 1.8rem;
    grid-template-columns: repeat(2, minmax(0, 1fr));
  }

  .testimonial {
    padding: 0;
    border: none;
    background: transparent;
  }

  .testimonial p {
    color: var(--color-text);
  }

  .testimonial__meta {
    display: flex;
    flex-direction: column;
    gap: 0.3rem;
    font-size: 0.9rem;
    color: var(--color-text-muted);
  }

  .stay-calendar {
    margin-top: 1.5rem;
    padding: 1.2rem;
    border-radius: 18px;
    background: #f7f7fa;
  }

  .calendar__loading,
  .calendar__empty {
    font-size: 0.9rem;
    color: var(--color-text-muted);
  }

  :global(.calendar) {
    display: grid;
    gap: 1.2rem;
    grid-template-columns: repeat(2, minmax(0, 1fr));
  }

  :global(.calendar__month-title) {
    font-weight: 600;
    margin-bottom: 0.6rem;
  }

  :global(.calendar__grid) {
    display: grid;
    grid-template-columns: repeat(7, minmax(0, 1fr));
    gap: 0.35rem;
    font-size: 0.85rem;
  }

  :global(.calendar__dow) {
    text-transform: uppercase;
    font-size: 0.65rem;
    letter-spacing: 0.08em;
    color: var(--color-text-muted);
    text-align: center;
  }

  :global(.calendar__cell) {
    height: 30px;
    display: grid;
    place-items: center;
    border-radius: 999px;
    background: transparent;
    color: var(--color-text);
  }

  :global(.calendar__cell.is-free) {
    background: rgba(0, 156, 255, 0.12);
    color: var(--color-text);
  }

  :global(.calendar__cell.is-busy) {
    background: rgba(255, 89, 0, 0.2);
    color: var(--color-text);
    text-decoration: line-through;
    text-decoration-thickness: 1px;
  }

  :global(.calendar__cell.is-past) {
    opacity: 0.4;
  }

  :global(.calendar__cell.is-empty) {
    background: transparent;
  }

  :global(.calendar__legend) {
    display: flex;
    gap: 1rem;
    font-size: 0.8rem;
    color: var(--color-text-muted);
    margin-top: 0.8rem;
  }

  :global(.legend) {
    width: 10px;
    height: 10px;
    border-radius: 50%;
    display: inline-block;
    margin-right: 0.35rem;
  }

  :global(.legend--free) {
    background: rgba(0, 156, 255, 0.4);
  }

  :global(.legend--busy) {
    background: rgba(255, 89, 0, 0.45);
  }

  @media (max-width: 1100px) {
    .apartments-hero__grid {
      grid-template-columns: 1fr;
    }

    .image-stack {
      height: 420px;
    }

    :global(.calendar) {
      grid-template-columns: 1fr;
    }

  }

  @media (max-width: 900px) {
    .stay-section--two .stay-grid {
      grid-template-columns: 1fr;
    }

    .stay-card--villa .stay-card__details {
      grid-template-columns: 1fr;
    }

    .adventure-grid {
      grid-template-columns: 1fr;
    }

    .adventure-pillars {
      grid-template-columns: 1fr;
    }

    .testimonials__grid {
      grid-template-columns: 1fr;
    }
  }

  @media (max-width: 640px) {
    .image-frame--wide {
      position: static;
      width: 100%;
      height: 40%;
      margin-top: 1rem;
      border: 0;
    }

    .image-stack {
      height: auto;
      display: grid;
      gap: 1rem;
    }

    .image-frame--tall {
      position: static;
      width: 100%;
      height: 320px;
    }

    .gallery-control {
      width: 34px;
      height: 34px;
    }

    .stay-card__slide {
      flex: 0 0 82%;
    }
  }

</style>
